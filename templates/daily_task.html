{% extends 'base.html' %}
{% block title %}Daily Task - {{ test.title }}{% endblock %}

{% block content %}
<link rel="stylesheet" href="/static/css/daily_task.css">
<div class="daily-task-container">
    <!-- Header with title, timer and streak info -->
    <div class="task-header">
        <div class="task-info">
            <div class="task-badge">
                <i class="fas fa-calendar-day"></i>
                <span>Daily Task</span>
            </div>
            <h2 class="task-title">{{ test.title }}</h2>
        </div>
        <div class="task-stats">
            <div class="streak-counter">
                <i class="fas fa-fire"></i>
                <span>{{ streak_count }} day streak</span>
            </div>
            <div class="task-timer" id="task-timer">
                <i class="far fa-clock"></i> <span id="timer-display">00:00:00</span>
            </div>
        </div>
    </div>

    <!-- Main content area -->
    <div class="task-content">
        <!-- Question area - now on the left -->
        <div class="question-area">
            <div class="question-container" id="question-container">
                <!-- Question content will be dynamically loaded here -->
            </div>
            
            <!-- Question navigation controls -->
            <div class="question-actions">
                <div class="action-buttons">
                    <button class="action-btn" id="mark-btn">
                        <i class="fas fa-flag"></i> Mark for Review
                    </button>
                    <button class="action-btn" id="clear-btn">
                        <i class="fas fa-eraser"></i> Clear Response
                    </button>
                </div>
                <div class="navigation-buttons">
                    <button class="nav-btn" id="prev-btn">
                        <i class="fas fa-chevron-left"></i> Previous
                    </button>
                    <button class="nav-btn primary" id="save-next-btn">
                        Save & Next <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Question palette and info -->
        <div class="task-sidebar">
            <div class="task-progress">
                <div class="progress-header">
                    <h4>Daily Progress</h4>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill" style="width: 0%"></div>
                </div>
                <div class="progress-stats">
                    <div class="stat-item">
                        <span class="stat-label">Answered:</span>
                        <span class="stat-value" id="answered-count">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Remaining:</span>
                        <span class="stat-value" id="remaining-count">{{ test.total_questions }}</span>
                    </div>
                </div>
            </div>
            
            <div class="question-palette">
                <div class="palette-header">
                    <h4>Questions</h4>
                </div>
                
                <div class="palette-legend">
                    <div class="legend-item">
                        <span class="question-status answered"></span>
                        <span>Answered</span>
                    </div>
                    <div class="legend-item">
                        <span class="question-status not-answered"></span>
                        <span>Not Answered</span>
                    </div>
                    <div class="legend-item">
                        <span class="question-status marked"></span>
                        <span>Marked</span>
                    </div>
                    <div class="legend-item">
                        <span class="question-status answered-and-marked"></span>
                        <span>Answered & Marked</span>
                    </div>
                </div>
                
                <div class="palette-content">
                    <div class="palette-body" id="question-palette-body">
                        <!-- Question numbers will be dynamically added here -->
                    </div>
                    
                    <div class="submit-container">
                        <button class="submit-task-btn" id="submit-task-btn">
                            <i class="fas fa-check-circle"></i> Complete Daily Task
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Confirmation modal for submitting test -->
    <div class="modal" id="submit-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Complete Daily Task</h3>
                <span class="modal-close" id="close-submit-modal">&times;</span>
            </div>
            <div class="modal-body">
                <div class="submit-summary" id="submit-summary">
                    <!-- Summary will be dynamically generated -->
                </div>
                <div class="submit-streak">
                    <i class="fas fa-fire"></i>
                    <p>Your daily streak will be extended to <span id="new-streak-count">{{ streak_count + 1 }}</span> days!</p>
                </div>
                <div class="submit-warning">
                    <i class="fas fa-exclamation-triangle"></i>
                    <p>Are you sure you want to submit your answers? This action cannot be undone.</p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="cancel-btn" id="cancel-submit">Continue Solving</button>
                <button class="confirm-btn" id="confirm-submit">Yes, Complete Task</button>
            </div>
        </div>
    </div>
    
    <!-- Success modal after completion -->
    <div class="modal" id="success-modal">
        <div class="modal-content success-content">
            <div class="success-header">
                <div class="success-icon">
                    <i class="fas fa-check-circle"></i>
                </div>
                <h3>Task Completed!</h3>
            </div>
            <div class="modal-body">
                <div class="success-message">
                    <p>Great job! You've completed your daily task and extended your streak.</p>
                    <div class="streak-animation">
                        <div class="streak-counter-large">
                            <i class="fas fa-fire"></i>
                            <span id="final-streak-count">{{ streak_count + 1 }}</span> day streak
                        </div>
                        <div class="streak-progress">
                            <div class="streak-bar">
                                <div class="streak-fill"></div>
                            </div>
                        </div>
                    </div>
                    <div class="score-display">
                        <div class="score-label">Your Score:</div>
                        <div class="score-value" id="final-score">0%</div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <a href="/dashboard" class="return-btn">
                    <i class="fas fa-home"></i> Return to Dashboard
                </a>
                <a href="#" id="view-analysis-btn" class="analysis-btn">
                    <i class="fas fa-chart-bar"></i> View Analysis
                </a>
            </div>
        </div>
    </div>
</div>

<script>
// Store test data for JavaScript access
const testData = {{ test|tojson|safe }};
const streakCount = {{ streak_count }};
</script>
<script src="/static/js/daily_task.js"></script>
{% endblock %}